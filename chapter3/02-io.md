# Linux系统中的I/O
<!-- toc -->

I/O操作分为：缓冲与非缓冲I/O、直接与非直接I/O、阻塞与非阻塞I/O、同步与异步I/O。

## 根据是否使用标准库缓存区分：缓冲与非缓冲I/O

标准库对外提供I/O操作接口，自身则是通过系统调用访问文件。标准库的实现中会使用一些缓存机制，使用了标准库缓存的I/O操作是 **缓冲I/O**，直接通过系统调用进行的I/O操作是 **非缓冲I/O**。

## 根据是否利用操作系统的页缓存：直接与非直接I/O

操作系统也会有缓存，跳过操作系统页缓存的I/O操作是 **直接I/O**，在系统调用时要指定`O_DIRECT`标志。

文件读写时，先经过系统页缓存、然后在通过系统调用落实到磁盘，这样的I/O操作是 **非直接I/O**。

在一些特殊场景中，譬如数据库，会连操作系统的文件系统一起跳过，直接读写磁盘， 这种操作通常称为 **裸I/O**。

## 根据程序是否阻塞自身运行：阻塞和非阻塞I/O

如果程序要等收到I/O操作结果后，才继续执行，这是 **阻塞I/O**。

如果程序发起I/O操作后，不等结果返回继续执行其它操作，以轮询或者事件的方式获得I/O操作结果，
这是 **非阻塞I/O**。

## 根据是否等待响应结果：同步和异步I/O

发起I/O操作，需要等整个I/O完成后才返回响应，这是 **同步I/O**。

发起I/O操作，不需要等整个I/O完成，I/O操作结束后，响应以事件的形式通知调用者，这是 **异步I/O**。

在操作文件时，如果设置了`O_DSYNC`或者`O_SYNC`标志，表示同步I/O，前者要等文件写入磁盘以后才返回，后者要在前者的基础，继续等待文件的元数据写入磁盘后，再返回。

在操作管道或者Socket时，如果设置了`O_ASYNC`，表示异步I/O，当文件可读写时，内核发送`SIGIO`或者`SIGPOLL`。

以上内容来自[倪鹏飞的Linux性能优化](https://www.lijiaocn.com/linux/img/linux/01-geek-linux-ercode.jpeg)。
